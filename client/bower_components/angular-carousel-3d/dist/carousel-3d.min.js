/*!
 * angular-carousel-3d
 * 
 * Version: 0.0.5 - 2015-10-06T21:00:31.924Z
 * License: MIT
 */
/*!
 * angular-carousel-3d
 * 
 * Version: 0.0.5
 * License: MIT
 */
!function(){"use strict";function t(t,e,i,n,o,s){function r(){m.slides=[],m.rightItems=[],m.leftItems=[],m.rightOutItem=null,m.leftOutItem=null,m.total=0,m.centerSlide=null,m.currentIndex=null,m.lock=!1,angular.extend(m.options,m.carousel3dOptions),v=angular.element(e[0].querySelector(".carousel-3d"));var t=v.children();if(!t.length>0)return!1;v.css({width:m.options.width+m.options.border+"px",height:m.options.height+m.options.border+"px"});for(var i=0;i<t.length;i++){var n=t[i],o=angular.element(n),s={outerwidth:m.options.width+m.options.border,outerheight:m.options.height+m.options.border,width:m.options.width,height:m.options.height,index:i},r={visibility:"hidden","border-width":m.options.border+"px"};o.attr(s),o.css(r),m.slides.push(o)}m.total=m.slides.length,m.options.startSlide=m.options.startSlide<0||m.options.startSlide>m.total?0:m.options.startSlide,m.currentIndex=m.options.startSlide,m.selectedSlide=m.slides[m.currentIndex],m.options.visible=m.options.visible>m.total?m.total:m.options.visible,m.options.visible=2===m.options.visible?m.options.visible%2?m.options.visible:m.options.visible:m.options.visible%2?m.options.visible:m.options.visible-1,a()}function a(t,e){var i=Math.floor(m.options.visible/2)+1;m.leftItems=[],m.rightItems=[];for(var n=1;i>n;n++){var o="ltr"==m.options.dir?(m.currentIndex+n)%m.total:(m.currentIndex-n)%m.total;m.leftItems.push(g(o));var s="ltr"==m.options.dir?(m.currentIndex-n)%m.total:(m.currentIndex+n)%m.total;m.rightItems.push(g(s))}m.leftOutItem=g(m.currentIndex-i),m.rightOutItem=g(m.total-m.currentIndex-i<=0?-parseInt(m.total-m.currentIndex-i):m.currentIndex+i);var r=m.leftOutItem,a=m.rightOutItem;"ltr"==m.options.dir&&(m.leftOutItem=a,m.rightOutItem=r);var d,c="auto"==m.options.topSpace?m.options.height/2-parseInt(m.selectedSlide.attr("outerheight"))/2:0,u=m.options.width/2-parseInt(m.selectedSlide.attr("outerwidth"))/2,h=(m.options.width/4,999),p={},f=e?e/1e3:m.options.animationSpeed/1e3;if(t)for(var v=0;v<m.slides.length;v++)m.slides[v].css({"-webkit-transition":"all "+f+"s ","-moz-transition":"all "+f+"s ","-o-transition":"all "+f+"s ","-ms-transition":"all "+f+"s ",transition:"all "+f+"s "});for(var I=0;I<m.slides.length;I++)m.slides[I].css({position:"absolute",opacity:0,visibility:"hidden",overflow:"hidden",top:c+"px"});m.selectedSlide.addClass("current").css({zIndex:h,opacity:1,visibility:"visible"}),m.selectedSlide.css({"-webkit-transform":"none","-moz-transform":"none","-o-transform":"none","-ms-transform":"none",transform:"none",left:u+"px",top:c+"px",width:m.selectedSlide.attr("width")+"px",height:m.selectedSlide.attr("height")+"px"});for(var x=0;x<m.rightItems.length;x++)d=m.rightItems[x],h-=x+1,p=l(d,x,h,!0),d.css(p).css({opacity:1,visibility:"visible",zIndex:h});for(var S=0;S<m.leftItems.length;S++)d=m.leftItems[S],h-=S+1,p=l(d,S,h),d.css(p).css({opacity:1,visibility:"visible",zIndex:h});if(m.total>m.options.visible){var b=l(m.rightOutItem,m.leftItems.length-.5,m.leftItems.length-1,!0),w=l(m.leftOutItem,m.leftItems.length-.5,m.leftItems.length-1);m.rightOutItem.css(b),m.leftOutItem.css(w)}m.isRendered=!0}function l(t,e,i,n){var o=parseInt("auto"==m.options.space?(e+1)*(parseInt(angular.element(t).attr("width"))/1.5):(e+1)*m.options.space),s=n?"translateX("+o+"px) translateZ(-"+(250+110*(e+1))+"px) rotateY(-"+m.options.perspective+"deg)":"translateX(-"+o+"px) translateZ(-"+(250+110*(e+1))+"px) rotateY("+m.options.perspective+"deg)",r="0%",a="auto"==m.options.topSpace?"none":parseInt((e+1)*m.options.space),l="none",d="none",c="visible";return{"-webkit-transform":s,"-moz-transform":s,"-o-transform":s,"-ms-transform":s,transform:s,left:r,top:a,width:l,height:d,zIndex:i,overflow:c}}function d(t,e,i){m.onBeforeChange&&m.onBeforeChange({index:m.currentIndex}),m.currentIndex=0>t||t>m.total-1?0:t,m.currentIndex==m.total-1&&m.onLastSlide&&m.onLastSlide({index:m.currentIndex}),m.selectedSlide=m.slides[m.currentIndex];for(var o=0;o<m.slides.length;o++)m.slides[o].removeClass("current");return m.lock=!0,a(!0,m.options.animationSpeed),n(function(){p()},m.options.animationSpeed),i?!1:!0}function c(t){return t=t?t:!1,!t&&m.lock?!1:(m.currentIndex==m.total?d(0,!1,t):d(m.currentIndex+1,!1,t),!1)}function u(t){return t=t?t:!1,!t&&m.lock?!1:(0==m.currentIndex?d(m.total-1,!1,t):d(m.currentIndex-1,!1,t),!1)}function h(t){var e=t==m.total-1&&0==m.currentIndex?-1:t-m.currentIndex;m.currentIndex==m.total-1&&0==t&&(e=1);for(var i=0>e?-e:e,o=0,s=0;i>s;s++){var r=1==i?0:o;n(function(){0>e?u(i):c(i)},r),o+=m.options.animationSpeed/i}}function p(){m.lock=!1,m.onSlideChange&&m.onSlideChange({index:m.currentIndex})}function g(t){return t>=0?m.slides[t]:m.slides[m.slides.length+t]}function f(t){m.currentIndex!=t?h(t):m.onSelectedClick&&m.onSelectedClick({index:m.currentIndex})}var m=this;m.isLoading=!0,m.isSuccessful=!1,m.isRendered=!1,m.percentLoaded=0,m.options={sourceProp:"src",visible:3,perspective:35,animationSpeed:500,startSlide:0,dir:"ltr",width:480,height:360,border:10,space:"auto",topSpace:"auto"},m.init=r,m.slideClicked=f,m.goPrev=u,m.goNext=c;var v=null;angular.extend(m.options,m.carousel3dOptions),e.css({height:m.options.height+m.options.border+"px"}),t.$watch("[vm.ngModel, vm.carousel3dOptions]",function(){s.preloadImages(m.ngModel,m.options.sourceProp).then(function(t){m.isLoading=!1,m.isSuccessful=!0,n(function(){r()})},function(t){m.isLoading=!1,m.isSuccessful=!1},function(t){m.percentLoaded=t.percent})},!0)}function e(t){function e(t,e){return i}function i(t,e,i,n,o){}var n={restrict:"AE",template:'<div class="carousel-3d-container" ng-switch="vm.isLoading">   <div class="carousel-3d-loader" ng-switch-when="true">       <div class="carousel-3d-loader-circle" style="-webkit-transform:scale(0.75)"><div><div></div><div></div></div></div>       <div class="carousel-3d-loader-percentage">{{ vm.percentLoaded }}</div>   </div>   <div ng-switch-when="false" ng-switch="vm.isSuccessful">       <div class="carousel-3d" ng-switch-when="true" ng-show="vm.isRendered">           <img ng-repeat="image in vm.ngModel track by $index" ng-src="{{image[vm.options.sourceProp]}}" class="slide-3d" ng-click="vm.slideClicked($index)" ng-swipe-left="vm.goPrev()" ng-swipe-right="vm.goNext()">       </div>       <p ng-switch-when="false" class="carousel-3d-loader-error">There was a problem during load</p>   </div></div>',replace:!0,scope:{ngModel:"=",carousel3dOptions:"=",onSelectedClick:"&",onSlideChange:"&",onLastSlide:"&",onBeforeChange:"&"},controller:"Carousel3dController as vm",bindToController:!0,compile:e,link:i};return n}function i(t,e){function i(e,i){this.imageLocations=e,this.imageProp=i,this.imageCount=this.imageLocations.length,this.loadCount=0,this.errorCount=0,this.states={PENDING:1,LOADING:2,RESOLVED:3,REJECTED:4},this.state=this.states.PENDING,this.deferred=t.defer(),this.promise=this.deferred.promise}function n(){return this.state!==this.states.PENDING}function o(){return this.state===this.states.REJECTED}function s(){return this.state===this.states.RESOLVED}function r(){if(this.isInitiated())return this.promise;this.state=this.states.LOADING;for(var t=0;t<this.imageCount;t++)this.loadImageLocation(this.imageLocations[t][this.imageProp]);return this.promise}function a(t){this.errorCount++,this.isRejected()||(this.state=this.states.REJECTED,this.deferred.reject(t))}function l(t){this.loadCount++,this.isRejected()||(this.deferred.notify({percent:Math.ceil(this.loadCount/this.imageCount*100),imageLocation:t}),this.loadCount===this.imageCount&&(this.state=this.states.RESOLVED,this.deferred.resolve(this.imageLocations)))}function d(t){var i=this,n=new Image;n.onload=function(t){e.$apply(function(){i.handleImageLoad(t.target.src),i=n=t=null})},n.onerror=function(t){e.$apply(function(){i.handleImageError(t.target.src),i=n=t=null})},n.src=t}i.preloadImages=function(t,e){var n=new i(t,e);return n.load()};var c={constructor:i,isInitiated:n,isRejected:o,isResolved:s,load:r,handleImageError:a,handleImageLoad:l,loadImageLocation:d};return angular.extend(i.prototype,c),i}angular.module("angular-carousel-3d",["swipe"]).factory("PreloaderService",i).directive("carousel3d",e).controller("Carousel3dController",t),t.$inject=["$scope","$element","$attrs","$timeout","$log","PreloaderService"],e.$inject=["$timeout"],i.$inject=["$q","$rootScope"]}();
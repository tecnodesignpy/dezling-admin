{"version":3,"file":"nested-option.js","sourceRoot":"","sources":["nested-option.ts"],"names":[],"mappings":"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","sourcesContent":["/*!\n * devextreme-angular\n * Version: 17.1.7\n * Build date: Wed Oct 04 2017\n *\n * Copyright (c) 2012 - 2017 Developer Express Inc. ALL RIGHTS RESERVED\n *\n * This software may be modified and distributed under the terms\n * of the MIT license. See the LICENSE file in the root of the project for details.\n *\n * https://github.com/DevExpress/devextreme-angular\n */\n\nimport { QueryList, ElementRef } from '@angular/core';\r\n\r\ndeclare function require(params: any): any;\r\nlet $ = require('jquery');\r\n\r\nimport { DX_TEMPLATE_WRAPPER_CLASS } from './template';\r\n\r\nconst VISIBILITY_CHANGE_SELECTOR = 'dx-visibility-change-handler';\r\n\r\nexport interface INestedOptionContainer {\r\n    instance: any;\r\n}\r\n\r\nexport interface IOptionPathGetter { (): string; }\r\n\r\nexport abstract class BaseNestedOption implements INestedOptionContainer, ICollectionNestedOptionContainer {\r\n    protected _host: INestedOptionContainer;\r\n    protected _hostOptionPath: IOptionPathGetter;\r\n    private _collectionContainerImpl: ICollectionNestedOptionContainer;\r\n    protected _initialOptions = {};\r\n\r\n    protected abstract get _optionPath(): string;\r\n    protected abstract _fullOptionPath(): string;\r\n\r\n    constructor() {\r\n        this._collectionContainerImpl = new CollectionNestedOptionContainerImpl(this._setOption.bind(this), this._filterItems.bind(this));\r\n    }\r\n\r\n    protected _getOption(name: string): any {\r\n        if (this.isLinked) {\r\n            return this.instance.option(this._fullOptionPath() + name);\r\n        } else {\r\n            return this._initialOptions[name];\r\n        }\r\n    }\r\n\r\n    protected _setOption(name: string, value: any) {\r\n        if (this.isLinked) {\r\n            this.instance.option(this._fullOptionPath() + name, value);\r\n        } else {\r\n            this._initialOptions[name] = value;\r\n        }\r\n    }\r\n\r\n    setHost(host: INestedOptionContainer, optionPath: IOptionPathGetter) {\r\n        this._host = host;\r\n        this._hostOptionPath = optionPath;\r\n    }\r\n\r\n    setChildren<T extends ICollectionNestedOption>(propertyName: string, items: QueryList<T>) {\r\n        return this._collectionContainerImpl.setChildren(propertyName, items);\r\n    }\r\n\r\n    _filterItems(items: QueryList<BaseNestedOption>) {\r\n        return items.filter((item) => { return item !== this; });\r\n    }\r\n\r\n    get instance() {\r\n        return this._host && this._host.instance;\r\n    }\r\n\r\n    get isLinked() {\r\n        return !!this.instance;\r\n    }\r\n}\r\n\r\nexport interface ICollectionNestedOptionContainer {\r\n    setChildren<T extends ICollectionNestedOption>(propertyName: string, items: QueryList<T>);\r\n}\r\n\r\nexport class CollectionNestedOptionContainerImpl implements ICollectionNestedOptionContainer {\r\n    private _activatedQueries = {};\r\n\r\n    constructor(private _setOption: Function, private _filterItems?: Function) {}\r\n\r\n    setChildren<T extends ICollectionNestedOption>(propertyName: string, items: QueryList<T>) {\r\n        if (this._filterItems) {\r\n            items = this._filterItems(items);\r\n        }\r\n        if (items.length) {\r\n            this._activatedQueries[propertyName] = true;\r\n        }\r\n        if (this._activatedQueries[propertyName]) {\r\n            let widgetItems = items.map((item, index) => {\r\n                item._index = index;\r\n                return item._value;\r\n            });\r\n            this._setOption(propertyName, widgetItems);\r\n        }\r\n    }\r\n}\r\n\r\nexport abstract class NestedOption extends BaseNestedOption {\r\n    setHost(host: INestedOptionContainer, optionPath: IOptionPathGetter) {\r\n        super.setHost(host, optionPath);\r\n\r\n        this._host[this._optionPath] = this._initialOptions;\r\n    }\r\n\r\n    protected _fullOptionPath() {\r\n        return this._hostOptionPath() + this._optionPath + '.';\r\n    }\r\n}\r\n\r\nexport interface ICollectionNestedOption {\r\n    _index: number;\r\n    _value: Object;\r\n}\r\n\r\nexport abstract class CollectionNestedOption extends BaseNestedOption implements ICollectionNestedOption {\r\n    _index: number;\r\n\r\n    protected _fullOptionPath() {\r\n        return this._hostOptionPath() + this._optionPath + '[' + this._index + ']' + '.';\r\n    }\r\n\r\n    get _value() {\r\n        return this._initialOptions;\r\n    }\r\n\r\n    get isLinked() {\r\n        return this._index !== undefined && !!this.instance;\r\n    }\r\n}\r\n\r\nexport interface IOptionWithTemplate extends BaseNestedOption {\r\n    template: any;\r\n}\r\nexport function extractTemplate(option: IOptionWithTemplate, element: ElementRef) {\r\n    if (!option.template === undefined || !element.nativeElement.hasChildNodes()) {\r\n        return;\r\n    }\r\n\r\n    let childNodes = [].slice.call(element.nativeElement.childNodes);\r\n    let userContent = childNodes.filter((n) => {\r\n        if (n.tagName) {\r\n            let tagNamePrefix = n.tagName.toLowerCase().substr(0, 3);\r\n            return !(tagNamePrefix === 'dxi' || tagNamePrefix === 'dxo');\r\n        } else {\r\n            return n.nodeName !== '#comment' && n.textContent.replace(/\\s/g, '').length;\r\n        }\r\n    });\r\n    if (!userContent.length) {\r\n        return;\r\n    }\r\n\r\n    function triggerShownEvent($element) {\r\n        let changeHandlers = $();\r\n\r\n        if ($element.hasClass(VISIBILITY_CHANGE_SELECTOR)) {\r\n            changeHandlers = $element;\r\n        }\r\n\r\n        changeHandlers = changeHandlers.add($element.find('.' + VISIBILITY_CHANGE_SELECTOR));\r\n\r\n        for (let i = 0; i < changeHandlers.length; i++) {\r\n            $(changeHandlers[i]).triggerHandler('dxshown');\r\n        }\r\n    }\r\n\r\n    option.template = {\r\n        render: (renderData) => {\r\n            let $result = $(element.nativeElement).addClass(DX_TEMPLATE_WRAPPER_CLASS);\r\n\r\n            if (renderData.container) {\r\n                let container = renderData.container.get(0);\r\n                let resultInContainer = container.contains(element.nativeElement);\r\n\r\n                renderData.container.append(element.nativeElement);\r\n\r\n                if (!resultInContainer) {\r\n                    let resultInBody = document.body.contains(container);\r\n\r\n                    if (resultInBody) {\r\n                        triggerShownEvent($result);\r\n                    }\r\n                }\r\n            }\r\n\r\n            return $result;\r\n        }\r\n    };\r\n}\r\n\r\nexport class NestedOptionHost {\r\n    private _host: INestedOptionContainer;\r\n    private _optionPath: IOptionPathGetter;\r\n\r\n    setHost(host: INestedOptionContainer, optionPath?: IOptionPathGetter) {\r\n        this._host = host;\r\n        this._optionPath = optionPath || (() => '');\r\n    }\r\n\r\n    setNestedOption(nestedOption: BaseNestedOption) {\r\n        nestedOption.setHost(this._host, this._optionPath);\r\n    }\r\n}\r\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}